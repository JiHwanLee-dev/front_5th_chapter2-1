import"./modulepreload-polyfill-B5Qt9EMX.js";const d=[{id:"p1",name:"상품1",val:1e4,q:50},{id:"p2",name:"상품2",val:2e4,q:30},{id:"p3",name:"상품3",val:3e4,q:20},{id:"p4",name:"상품4",val:15e3,q:0},{id:"p5",name:"상품5",val:25e3,q:10}];function u(n,e={},t=""){const a=document.createElement(n);for(const[o,i]of Object.entries(e))a.setAttribute(o,i);return t&&(a.textContent=t),a}function I(){return u("div",{class:"bg-gray-100 p-8"})}function b(){return u("div",{class:"max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-8"})}function E(){return u("h1",{class:"text-2xl font-bold mb-4"},"장바구니")}function S(){return u("div",{id:"cart-items"})}function w(){return u("div",{id:"cart-total",class:"text-xl font-bold my-4"})}function k(){return u("select",{id:"product-select",class:"border rounded p-2 mr-2"})}function D(){return u("button",{id:"add-to-cart",class:"bg-blue-500 text-white px-4 py-2 rounded"},"추가")}function M(){return u("div",{id:"stock-status",class:"text-sm text-gray-500 mt-2"})}function B(){return u("span",{id:"loyalty-points",class:"text-blue-500 ml-2"})}function P(n){return u("div",{id:n,class:"flex justify-between items-center mb-2"})}function $(n){return Math.floor(n/1e3)}function L(n,e){let t=document.getElementById("loyalty-points");return t||(t=B(),e.appendChild(t)),t.textContent=`(포인트: ${n})`,t}function R(n,e){const t=$(n);return L(t,e)}function x(n,e){e.innerHTML="",n.forEach(function(t){const a=document.createElement("option");a.value=t.id,a.textContent=t.name+" - "+t.val+"원",t.q===0&&(a.disabled=!0),e.appendChild(a)})}function H(n,e){let t="";n.forEach(function(a){a.q<5&&(t+=a.name+": "+(a.q>0?"재고 부족 ("+a.q+"개 남음)":"품절")+`
`)}),e.textContent=t}function N(n,e){setTimeout(function(){setInterval(function(){const t=n[Math.floor(Math.random()*n.length)];Math.random()<.3&&t.q>0&&(t.val=Math.round(t.val*.8),alert("번개세일! "+t.name+"이(가) 20% 할인 중입니다!"),e())},3e4)},Math.random()*1e4)}function O(n,e,t){setTimeout(function(){setInterval(function(){if(e){const a=n.find(function(o){return o.id!==e&&o.q>0});a&&(alert(a.name+"은(는) 어떠세요? 지금 구매하시면 5% 추가 할인!"),a.val=Math.round(a.val*.95),t())}},6e4)},Math.random()*2e3)}function Q(n,e,t,a,o,i){n.addEventListener("click",()=>{const r=t.value,s=a.find(l=>l.id===r);if(!s||s.q<=0)return;const c=document.getElementById(s.id);c?j(c,s):F(s,e),o(),i(r)})}function j(n,e){const t=parseInt(n.querySelector("span").textContent.split("x ")[1])+1;t<=e.q?(n.querySelector("span").textContent=`${e.name} - ${e.val}원 x ${t}`,e.q--):alert("재고가 부족합니다.")}function F(n,e){const t=P(n.id);t.innerHTML=`
                <span>${n.name} - ${n.val}원 x 1</span>
                <div>
                    <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" 
                            data-product-id="${n.id}" data-change="-1">-</button>
                    <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" 
                            data-product-id="${n.id}" data-change="1">+</button>
                    <button class="remove-item bg-red-500 text-white px-2 py-1 rounded" 
                            data-product-id="${n.id}">삭제</button>
                </div>
            `,e.appendChild(t),n.q--}function T(n,e,t){n.addEventListener("click",a=>{const o=a.target;if(!o.classList.contains("quantity-change")&&!o.classList.contains("remove-item"))return;const i=o.dataset.productId,r=document.getElementById(i),s=e.find(function(c){return c.id===i});if(o.classList.contains("quantity-change")){const c=parseInt(o.dataset.change),l=parseInt(r.querySelector("span").textContent.split("x ")[1])+c;l>0&&l<=s.q+parseInt(r.querySelector("span").textContent.split("x ")[1])?(r.querySelector("span").textContent=r.querySelector("span").textContent.split("x ")[0]+"x "+l,s.q-=c):l<=0?(r.remove(),s.q-=c):alert("재고가 부족합니다.")}else if(o.classList.contains("remove-item")){const c=parseInt(r.querySelector("span").textContent.split("x ")[1]);s.q+=c,r.remove()}t()})}function W(n,e){let t=0;const a={p1:.1,p2:.15,p3:.2,p4:.05,p5:.25};return n>10&&(t=a[e.id]||0),t}function A(n,e,t){let a=0;if(n>=30){const o=t*.25,i=e-t;o>i?(t=e*(1-.25),a=.25):a=(e-t)/e}else a=(e-t)/e;return{totalAfterBulkDiscount:t,bulkDIscountRate:a}}function U(n,e){let t=n,a=e;return new Date().getDay()===2&&(t=n*.9,a=Math.max(e,.1)),{finalAmount:t,finalDiscountRate:a}}function _(n,e){let t=0,a=0,o=0;for(let i=0;i<n.length;i++)(function(){const r=n[i],s=e.find(q=>q.id===r.id),c=parseInt(r.querySelector("span").textContent.split("x ")[1]),l=s.val*c,C=W(c,s);a+=c,o+=l,t+=l*(1-C)})();return{totalAmount:t,productCount:a,subTotalBeforeDiscount:o}}function z(n,e){let{totalAmount:t,productCount:a,subTotalBeforeDiscount:o}=_(n,e);const{totalAfterBulkDiscount:i,bulkDIscountRate:r}=A(a,o,t),{finalAmount:s,finalDiscountRate:c}=U(i,r);return{totalAmount:s,discountRate:c}}const f=S(),m=w(),p=k(),h=D(),g=M();let v;function G(){const n=document.getElementById("app"),e=I(),t=b(),a=E();x(d,p),t.append(a,f,m,p,h,g),e.appendChild(t),n.appendChild(e),y(),N(d,()=>x(d,p)),O(d,v,()=>x(d,p)),Q(h,f,p,d,y,o=>{v=o}),T(f,d,y)}function y(){let n=f.children;const{totalAmount:e,discountRate:t}=z(n,d);if(m.textContent="총액: "+Math.round(e)+"원",t>0){const a=document.createElement("span");a.className="text-green-500 ml-2",a.textContent="("+(t*100).toFixed(1)+"% 할인 적용)",m.appendChild(a)}H(d,g),R(e,m)}G();
